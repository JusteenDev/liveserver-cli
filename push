#!/data/data/com.termux/files/usr/bin/bash

# Ensure the user is in the git repository
if [ ! -d .git ]; then
  echo "This is not a git repository."
  exit 1
fi

# Set the username and personal access token (replace with your token)
GIT_USERNAME="JusteenDev"
GIT_TOKEN="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"

# Define the repository URL (replace with the actual repo)
REPO_URL="https://github.com/JusteenDev/liveserver-cli.git"

# Correct URL without the extra https://
REMOTE_URL="https://$GIT_USERNAME:$GIT_TOKEN@$REPO_URL"

# Commit message (automated)
commit_message="Auto commit - $(date)"

# Specify the file to modify
FILE_NAME="./index.js"

# Loop to modify, commit, and push every 10 seconds
while true; do
  # Check if there are any changes in the git repo
  git status --porcelain | grep -q . || { echo "No changes to commit."; sleep 10; continue; }

  # Step 1: Add a character to the file (./index.js)
  echo "a" >> "$FILE_NAME"  # Adds 'a' to the file

  # Step 2: Stage all changes
  git add .

  # Commit the changes
  git commit -m "Add character 'a' - $commit_message"

  # Set the remote URL with token-based authentication
  git remote set-url origin $REMOTE_URL

  # Push the changes to the remote repository
  git push origin main

  echo "Character 'a' added to $FILE_NAME, changes committed, and pushed."

  # Wait for 10 seconds
  sleep 10

  # Step 3: Remove the character 'a' from the file (simulating a delete)
  sed -i '' 's/a//g' "$FILE_NAME"  # Removes 'a' from the file

  # Step 4: Stage all changes again after modification
  git add .

  # Commit the changes (removing 'a')
  git commit -m "Remove character 'a' - $commit_message"

  # Push the changes to the remote repository
  git push origin main

  echo "Character 'a' removed from $FILE_NAME, changes committed, and pushed."

  # Wait for 10 seconds before the next modification cycle
  sleep 10
done